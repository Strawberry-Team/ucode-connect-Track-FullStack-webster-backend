# Сутності та зв'язки проєкту

Цей документ описує основні сутності (моделі даних), їхнє бізнес-призначення та зв'язки між ними в проєкті.

## 1. Сутності

### User

*   **Бізнес-призначення:** Представляє користувача системи. Зберігає всю основну інформацію про обліковий запис користувача та його профіль.
*   **Ключові поля:**
    *   `id`: Унікальний ідентифікатор користувача.
    *   `email`: Унікальна електронна пошта користувача (використовується для входу).
    *   `password`: Хеш пароля користувача.
    *   `firstName`, `lastName`: Ім'я та прізвище користувача.
    *   `role`: Роль користувача в системі (визначається енумом `UserRole`).
    *   `isEmailVerified`: Статус підтвердження електронної пошти.
    *   `profilePictureName`: Ім'я файлу аватара користувача.
    *   `createdAt`, `updatedAt`: Час створення та останнього оновлення запису.
*   **Використання:** Об'єкти `User` використовуються на всіх рівнях застосунку для ідентифікації користувача, перевірки його прав та доступу до профільної інформації.

### RefreshTokenNonce

*   **Бізнес-призначення:** Використовується для реалізації механізму відкликання (invalidate) refresh-токенів. Кожен запис асоціюється з користувачем і представляє унікальний nonce (випадкове значення), яке може бути включене до refresh-токена. Зміна nonce користувача призводить до недійсності всіх раніше виданих refresh-токенів з цим nonce.
*   **Ключові поля:**
    *   `id`: Унікальний ідентифікатор запису nonce.
    *   `userId`: Ідентифікатор користувача, до якого належить nonce.
    *   `nonce`: Унікальне випадкове значення.
    *   `createdAt`: Час створення запису nonce.
*   **Використання:** Ці сутності використовуються модулем аутентифікації для забезпечення безпеки сесій користувачів, зокрема для можливості виходу з усіх пристроїв або відкликання токенів після зміни пароля. Безпосереднє використання в бізнес-логіці за межами модуля аутентифікації є рідкісним.

### UserRole (Енум)

*   **Бізнес-призначення:** Визначає фіксований набір можливих ролей, які може мати користувач у системі. Використовується для реалізації рольової моделі доступу (Role-Based Access Control - RBAC).
*   **Можливі значення:** `USER`, `ADMIN`.
*   **Використання:** Значення цього енуму призначається полю `role` сутності `User` і використовується Guards та іншою логікою авторизації для визначення дозволів користувача.

## 2. Зв'язки між сутностями

### User та RefreshTokenNonce (Один-до-Багатьох)

*   **Опис зв'язку:** Один користувач (`User`) може мати багато записів `RefreshTokenNonce` (`RefreshTokenNonce[]`), але кожен запис `RefreshTokenNonce` належить тільки одному користувачеві (`User`).
*   **Реалізація в Prisma:** Зв'язок реалізовано через поле `userId` у моделі `RefreshTokenNonce`, яке є зовнішнім ключем, що посилається на `id` користувача. У моделі `User` є поле `refreshTokenNonces`, яке є масивом пов'язаних об'єктів `RefreshTokenNonce`.
*   **Використання:** Цей зв'язок дозволяє отримати всі активні nonce для певного користувача (хоча зазвичай використовується лише останній доданий nonce) або знайти користувача за записом nonce.

### User та UserRole (Пряме значення енуму)

*   **Опис зв'язку:** Сутність `User` має поле `role`, яке приймає значення з енуму `UserRole`. Це не класичний зв'язок між двома таблицями, а скоріше обмеження на значення поля `role`.
*   **Реалізація в Prisma:** Поле `role` у моделі `User` оголошено з типом `UserRole`.
*   **Використання:** Доступ до ролі користувача здійснюється безпосередньо через поле `user.role`. Порівняння значення цього поля зі значеннями енуму `UserRole` дозволяє реалізувати логіку авторизації. 